<!-- filename: web/index.html -->
<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Sổ chi tiêu</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1115;--text:#e5e7eb;--muted:#9ca3af;--card:#171923;--border:#222;
      --accent:#22c55e;--danger:#ef4444;--safe:env(safe-area-inset-bottom,0px);--header-h:52px
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}

    header{
      position:sticky;top:0;z-index:10;padding:12px 16px;background:var(--bg);
      border-bottom:1px solid var(--border);display:flex;gap:8px;align-items:center;justify-content:space-between;
      min-height:var(--header-h)
    }

    .progress{position:absolute;left:0;right:0;bottom:0;height:2px;background:var(--accent);width:0%;opacity:0;pointer-events:none;transition:width .4s ease,opacity .2s}
    h1{margin:0;font-size:16px}

    /* Badge */
    .badge{
      display:inline-flex;align-items:center;gap:6px;
      padding:4px 8px;border:1px solid var(--border);border-radius:999px;color:var(--muted);font-size:12px
    }
    /* Chip for labels */
    .chip{display:inline-flex;align-items:center;padding:4px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px}
    .chip.muted{color:var(--muted)}

    .container{padding:12px;max-width:960px;margin:0 auto}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px}
    .toolbar{display:flex;gap:8px;align-items:center}

    .btn{display:inline-flex;align-items:center;justify-content:center;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#1f2937;color:var(--text);cursor:pointer}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btn-primary{background:var(--accent);border-color:#16a34a;color:#07110b;font-weight:600}
    .btn-danger{background:var(--danger);border-color:#b91c1c;color:#fff}
    /* Icon button */
    .btn-icon{padding:8px;width:40px;height:40px}
    .btn-icon svg{width:18px;height:18px;display:block}

    .form{padding:12px;display:grid;gap:10px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:8px}

    input,select,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid #2a2f3c;background:#0e111a;color:var(--text);font-size:15px}
    textarea{min-height:72px;resize:vertical}

    #list{margin-top:12px}

    /* ===== LIST / ITEM ===== */
    .item{display:grid;gap:8px;padding:12px;border-bottom:1px dashed #262a36;text-align:left}
    .item[role="button"]{cursor:pointer}
    .item[role="button"]:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
    .item:last-child{border-bottom:none}
    .top{display:grid;grid-template-columns:1fr auto;align-items:start;gap:8px}
    /* Left-align list items */
    .list--left .top{grid-template-columns:1fr}
    .list--left .top .amount{justify-self:start}

    .title{font-weight:600;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;word-break:break-word;overflow-wrap:anywhere}
    .amount{font-weight:800;font-variant-numeric:tabular-nums;white-space:nowrap;max-width:100%;font-size:clamp(14px,4.5vw,18px);line-height:1.15}
    .amount.expense{color:var(--danger)} .amount.income{color:var(--accent)}

    .meta{display:flex;gap:8px;flex-wrap:wrap;color:var(--muted);font-size:12px;overflow-wrap:anywhere;word-break:break-word}
    .meta .note{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}

    .empty{color:var(--muted);padding:16px;text-align:center}

    /* ===== STATS ===== */
    .stats-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px;padding:12px}
    .stat{background:#131722;border:1px solid var(--border);border-radius:10px;padding:8px}
    .stat-title{font-size:12px;color:var(--muted)}
    .stat-value{font-weight:800;font-size:clamp(14px,5.2vw,18px);margin-top:2px}
    .stat-sub{font-size:11px;color:var(--muted)}

    /* ===== SHEET ===== */
    .sheet{position:fixed;left:0;right:0;bottom:0;transform:translateY(100%);transition:transform .25s ease;z-index:50;background:var(--card);border-top:1px solid var(--border);border-top-left-radius:16px;border-top-right-radius:16px;box-shadow:0 -8px 24px rgba(0,0,0,.35)}
    .sheet.open{transform:translateY(0)}
    .sheet .drag{width:40px;height:4px;background:#3a4152;border-radius:99px;margin:8px auto}
    .sheet .wrap{padding:12px 12px calc(12px + var(--safe))}
    .sheet .row{display:grid;gap:8px;margin-bottom:10px}
    .sheet .row2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .sheet .head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    .sheet .head h2{margin:0;font-size:15px}
    .mainpad{height:70px}

    .spinner{width:16px;height:16px;border:2px solid transparent;border-top-color:var(--text);border-right-color:var(--text);border-radius:50%;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    body[data-loading="1"] .btn{pointer-events:none;opacity:.7}

    .skeleton .title,.skeleton .meta span{display:inline-block;background:linear-gradient(90deg,#2a2f3c,#3a4152,#2a2f3c);background-size:200% 100%;animation:shimmer 1.2s linear infinite;color:transparent;border-radius:6px}
    .skeleton .title{height:16px;width:40%}
    .skeleton .meta span{height:12px;width:20%}
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

    /* ===== Responsive ===== */
    @media (min-width:700px){
      h1{font-size:18px}
      .grid2{grid-template-columns:240px 1fr}
      .top .amount{font-size:18px}
      .title{-webkit-line-clamp:1}
    }
    @media (max-width:420px){
      .container{padding:10px}
      .toolbar{gap:6px}
      #user.badge{display:none}
      .top{grid-template-columns:1fr}
      .top .amount{justify-self:start;font-size:clamp(16px,6vw,20px)}
      .meta{font-size:11px}
      .stats-grid{grid-template-columns:repeat(2,minmax(0,1fr))}
    }
    @media (max-width:340px){.stats-grid{grid-template-columns:1fr}}
  </style>
  <style>
    /* Pager variables */
    :root { --pager-top: var(--header-h); }
    .header-hidden { --pager-top: 0px; } /* when header collapses */

    /* Sticky + compact pager */
    #pager { position: sticky; top: var(--pager-top); z-index: 9; backdrop-filter: blur(4px); }
    #pager.pager { display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 8px; padding: 6px 8px !important; border-radius: 10px; }
    #pager .pager-left, #pager .pager-right { display: flex; align-items: center; gap: 6px; }
    #pager .btn.btn-icon { width: 36px; height: 36px; padding: 6px; }
    #pager .btn { min-width: auto; }
    #pager select { padding: 6px 8px; min-width: 56px; height: 32px; font-size: 13px; }
    #page-range.badge { font-size: 11px; padding: 3px 6px; }

    /* Hide labels on small screens; keep select + nav + range */
    @media (max-width: 480px) {
      #pager .chip { display: none; }
      #pager.pager { gap: 6px; }
    }
  </style>
</head>

<body>
  <header>
    <h1>Sổ chi tiêu</h1>
    <div class="toolbar">
      <span id="user" class="badge">Đang đăng nhập...</span>
      <span id="net" class="spinner" aria-hidden="true" style="display:none"></span>
      <button id="reload" class="btn">Tải lại</button>
      <button id="add-open" class="btn btn-primary">Thêm</button>
    </div>
    <div id="bar" class="progress" aria-hidden="true"></div>
  </header>

  <div class="container">
    <div id="stats" class="card" style="margin-top:12px">
      <div class="stats-grid">
        <div class="stat"><div class="stat-title">Hôm nay</div><div class="stat-value" id="stats-day">0 ₫</div><div class="stat-sub">Tổng chi</div></div>
        <div class="stat"><div class="stat-title">Tháng này</div><div class="stat-value" id="stats-month">0 ₫</div><div class="stat-sub">Tổng chi</div></div>
        <div class="stat"><div class="stat-title">Năm nay</div><div class="stat-value" id="stats-year">0 ₫</div><div class="stat-sub">Tổng chi</div></div>
      </div>
    </div>

    <div id="pager" class="card" style="margin-top:12px;padding:8px 12px;display:flex;align-items:center;gap:8px;justify-content:space-between">
      <div style="display:flex;align-items:center;gap:8px">
        <span class="chip muted">Hiển thị</span>
        <select id="page-size">
          <option value="10">10</option>
          <option value="20" selected>20</option>
          <option value="50">50</option>
        </select>
        <span class="chip muted">/ trang</span>
      </div>
      <div style="display:flex;align-items:center;gap:8px">
        <button id="page-prev" class="btn btn-icon" aria-label="Trang trước" title="Trang trước">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <button id="page-next" class="btn btn-icon" aria-label="Trang sau" title="Trang sau">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
        <span id="page-range" class="badge">0-0 / 0</span>
      </div>
    </div>

    <!-- left-aligned list -->
    <div id="list" class="card list--left"></div>

    <p class="badge" style="display:block;margin-top:10px">Mẹo: Chạm mục để sửa.</p>
    <div class="mainpad"></div>
  </div>

  <div id="sheet" class="sheet" aria-hidden="true">
    <div class="drag"></div>
    <div class="wrap">
      <div class="head">
        <h2 id="sheet-title">Thêm giao dịch</h2>
        <button id="sheet-close" class="btn">Đóng</button>
      </div>
      <div class="row"><input id="e-merchant" placeholder="Diễn giải" /></div>
      <div class="row row2">
        <input id="e-amount" inputmode="decimal" placeholder="Số tiền (VND)" />
        <input id="e-date" type="date" />
      </div>
      <div class="row row2">
        <select id="e-category"></select>
        <input id="e-note" placeholder="Ghi chú" />
      </div>
      <div class="row row2">
        <select id="e-type">
          <option value="expense">Chi</option>
          <option value="income">Thu</option>
        </select>
        <div></div>
      </div>
      <div class="row" style="display:flex;gap:8px;justify-content:flex-end">
        <button id="e-delete" class="btn btn-danger" style="display:none">Xoá</button>
        <button id="e-save" class="btn btn-primary">Lưu</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" aria-live="polite"
       style="position:fixed;left:50%;bottom:calc(12px + var(--safe));transform:translateX(-50%) translateY(20px);background:#111827;color:#e5e7eb;padding:10px 14px;border:1px solid #222;border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,.35);opacity:0;pointer-events:none;transition:opacity .2s, transform .2s;z-index:60;max-width:90%;white-space:pre-line">
  </div>

  <script type="module" src="./app.js"></script>
</body>
</html>
